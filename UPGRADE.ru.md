# PhoenixKit Upgrade Guide

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é PhoenixKit –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

## üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ v1.0.0+ (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞)

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å dependency

–í `mix.exs` –æ–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é:

```elixir
def deps do
  [
    # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è:
    # {:phoenix_kit, git: "https://github.com/BeamLabEU/phoenixkit.git", tag: "v0.x.x"}
    
    # –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:
    {:phoenix_kit, git: "https://github.com/BeamLabEU/phoenixkit.git", tag: "v1.0.0"}
  ]
end
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
mix deps.update phoenix_kit
mix deps.get
```

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤)
mix phoenix_kit.gen.routes --dry-run

# –û–±–Ω–æ–≤–∏—Ç—å router –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
mix phoenix_kit.gen.routes --force

# –û–±–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ)
mix phoenix_kit.gen.migration

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
mix phoenix_kit.install --force
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **Router configuration** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ routes –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:
   ```elixir
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   import BeamLab.PhoenixKitWeb.UserAuth,
     only: [fetch_current_scope_for_user: 2, redirect_if_user_is_authenticated: 2, require_authenticated_user: 2]
   
   # –í browser pipeline:
   plug :fetch_current_scope_for_user
   ```

2. **Configuration** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `config/config.exs`:
   ```elixir
   config :phoenix_kit, mode: :library
   ```

3. **Migrations** - –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   mix ecto.migrate
   ```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é
mix compile

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
mix test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
mix phx.server
```

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Router –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤ router.ex

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–∫–∞–∂–µ—Ç —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
mix phoenix_kit.gen.routes --dry-run

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç
mix phoenix_kit.gen.routes --force
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç

**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∏ –æ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –º–∏–≥—Ä–∞—Ü–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
ls priv/repo/migrations/ | grep phoenix_kit

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ PhoenixKit (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
rm priv/repo/migrations/*phoenix_kit*

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ
mix phoenix_kit.gen.migration
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–°–∏–º–ø—Ç–æ–º:** –î—É–±–ª–∏—Ä—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ config.exs

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ PhoenixKit –∏–∑ config/config.exs
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å:
mix phoenix_kit.install --no-migrations
```

## üìã Checklist –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

- [ ] –û–±–Ω–æ–≤–∏–ª dependency –≤ mix.exs
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª `mix deps.update phoenix_kit`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª router configuration
- [ ] –û–±–Ω–æ–≤–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –∫–æ–º–ø–∏–ª—è—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç

## üÜò –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. **–û—Ç–∫–∞—Ç–∏—Ç—å dependency:**
   ```elixir
   {:phoenix_kit, git: "https://github.com/BeamLabEU/phoenixkit.git", tag: "v0.x.x"}
   ```

2. **–û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```bash
   mix ecto.rollback --step 1
   ```

3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ git:**
   ```bash
   git restore lib/your_app_web/router.ex
   git restore config/config.exs
   ```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Issues –Ω–∞ GitHub](https://github.com/BeamLabEU/phoenixkit/issues)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π issue —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–±–ª–µ–º—ã
3. –ü—Ä–∏–ª–æ–∂–∏—Ç–µ –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥ `mix compile` –∏ `mix phoenix_kit.install --dry-run`